<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>utils.file_management &mdash; NextCloud Functionl Tests 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            NextCloud Functionl Tests
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">functional_testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NextCloud Functionl Tests</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">utils.file_management</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for utils.file_management</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">selenium.webdriver.support.expected_conditions</span> <span class="kn">import</span> <span class="n">staleness_of</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">WebDriverException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">functional_testing.utils.authentication_management</span> <span class="kn">import</span><span class="p">(</span>
     <span class="n">orange_text</span><span class="p">,</span>
     <span class="n">green_text</span><span class="p">,</span>
     <span class="n">login_to_nextcloud</span><span class="p">,</span>
     <span class="n">perform_logout</span><span class="p">,</span>
     <span class="n">get_token_from_cookies</span><span class="p">,</span>
     <span class="n">check_if_loggedIn</span><span class="p">,</span>
     <span class="n">check_logout</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">functional_testing.config.configuration</span> <span class="kn">import</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">,</span> <span class="n">TARGET_URL</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<div class="viewcode-block" id="generate_file_share_button">
<a class="viewcode-back" href="../../utils.html#utils.file_management.generate_file_share_button">[docs]</a>
<span class="k">def</span> <span class="nf">generate_file_share_button</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Locates and returns the share button for a given file in a web page.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The web driver instance controlling the browser.</span>
<span class="sd">        file_name (str): The name of the file for which to find the share button.</span>

<span class="sd">    Returns:</span>
<span class="sd">        WebElement: The share button element for the specified file.</span>
<span class="sd">        Returns None if the share button could not be found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Construct the XPath expression to locate the share button</span>
        <span class="n">xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;]//a[contains(@class, &#39;action-share&#39;)]&quot;</span>
        
        <span class="c1"># Locate the share button using the constructed XPath</span>
        <span class="n">share_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">))</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">share_button</span>
    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
        <span class="c1"># If no element is found, print a message and return None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Share button not found for file &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    
    
<span class="c1">### File Creation ### </span>
<div class="viewcode-block" id="create_testing_files">
<a class="viewcode-back" href="../../utils.html#utils.file_management.create_testing_files">[docs]</a>
<span class="k">def</span> <span class="nf">create_testing_files</span><span class="p">(</span><span class="n">FILE_SIZE_MEDIUM</span><span class="p">,</span> <span class="n">FILE_SIZE_LARGE</span><span class="p">,</span> <span class="n">CREATED_FILES_PATH</span><span class="p">,</span> <span class="n">TEST_FILE_BASE_MEDIUM</span><span class="p">,</span> <span class="n">TEST_FILE_BASE_LARGE</span><span class="p">,</span> <span class="n">EXTENSION</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a medium size file and a large size file for testing purposes.</span>

<span class="sd">    Args:</span>
<span class="sd">        FILE_SIZE_MEDIUM (int): The size of the medium size file in bytes.</span>
<span class="sd">        FILE_SIZE_LARGE (int): The size of the large size file in bytes.</span>
<span class="sd">        CREATED_FILES_PATH (str): The path to the directory where the files will be created.</span>
<span class="sd">        base_name (str): The base name of the files.</span>
<span class="sd">        extension (str): The extension of the files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The path to the medium size file.</span>
<span class="sd">        str: The name of the medium size file.</span>
<span class="sd">        str: The path to the large size file.</span>
<span class="sd">        str: The name of the large size file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">medium_size_file_path</span><span class="p">,</span> <span class="n">medium_size_file_name</span> <span class="o">=</span> <span class="n">create_file</span><span class="p">(</span><span class="n">FILE_SIZE_MEDIUM</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">CREATED_FILES_PATH</span><span class="p">,</span> <span class="n">base_name</span><span class="o">=</span><span class="n">TEST_FILE_BASE_MEDIUM</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="n">EXTENSION</span><span class="p">)</span>
    <span class="n">large_size_file_path</span><span class="p">,</span> <span class="n">large_size_file_name</span> <span class="o">=</span> <span class="n">create_file</span><span class="p">(</span><span class="n">FILE_SIZE_LARGE</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">CREATED_FILES_PATH</span><span class="p">,</span> <span class="n">base_name</span><span class="o">=</span><span class="n">TEST_FILE_BASE_LARGE</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="n">EXTENSION</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">medium_size_file_path</span><span class="p">,</span> <span class="n">medium_size_file_name</span><span class="p">,</span> <span class="n">large_size_file_path</span><span class="p">,</span> <span class="n">large_size_file_name</span></div>


<div class="viewcode-block" id="extract_filename">
<a class="viewcode-back" href="../../utils.html#utils.file_management.extract_filename">[docs]</a>
<span class="k">def</span> <span class="nf">extract_filename</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the filename from a given file path.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path of the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The filename extracted from the file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="extract_file_type">
<a class="viewcode-back" href="../../utils.html#utils.file_management.extract_file_type">[docs]</a>
<span class="k">def</span> <span class="nf">extract_file_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the file type from the given file path.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path of the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The file type.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; extract_file_type(&#39;/path/to/file.txt&#39;)</span>
<span class="sd">        &#39;txt&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="create_file">
<a class="viewcode-back" href="../../utils.html#utils.file_management.create_file">[docs]</a>
<span class="k">def</span> <span class="nf">create_file</span><span class="p">(</span><span class="n">file_size_mb</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./created_files&quot;</span><span class="p">,</span> <span class="n">base_name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a file of a specific size in megabytes in the specified directory with an automatically generated name.</span>

<span class="sd">    Args:</span>
<span class="sd">    file_size_mb (int): The size of the file in megabytes.</span>
<span class="sd">    directory (str): The directory where the file will be created.</span>
<span class="sd">    base_name (str): Base name for the file.</span>
<span class="sd">    extension (str): File extension.</span>

<span class="sd">    Returns:</span>
<span class="sd">    str: The path of the created file.</span>
<span class="sd">    str: The name of the created file.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the target directory exists</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Convert size from MB to bytes</span>
    <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">file_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

    <span class="c1"># Generate a unique file name</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

    <span class="c1"># Create the file with the specified size</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">file_size_bytes</span><span class="p">)</span>

    <span class="c1"># Return the path of the created file</span>
    <span class="k">return</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_name</span></div>


<span class="c1">### File Upload ###</span>

<div class="viewcode-block" id="perform_file_upload">
<a class="viewcode-back" href="../../utils.html#utils.file_management.perform_file_upload">[docs]</a>
<span class="k">def</span> <span class="nf">perform_file_upload</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_upload_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uploads a file and returns the XPath for checking its presence.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance.</span>
<span class="sd">        file_path (str): The path of the file to upload.</span>
<span class="sd">        file_upload_id (str): The ID of the file upload input element.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The XPath for checking the presence of the uploaded file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_input</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">file_upload_id</span><span class="p">)</span>
    <span class="n">orange_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploading file to NexCloud from localhost. File path: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
       
    <span class="n">file_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">extract_filename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;]&quot;</span></div>


<div class="viewcode-block" id="check_file_presence">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_file_presence">[docs]</a>
<span class="k">def</span> <span class="nf">check_file_presence</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_xpath</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the uploaded file is present in NextCloud.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_xpath (str): The XPath expression to locate the file element.</span>
<span class="sd">        wait_time (int): The maximum time (in seconds) to wait for the file to be present.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the file is present within the specified wait time, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for the file to apear in the list</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">file_xpath</span><span class="p">)))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="scroll_element_into_view">
<a class="viewcode-back" href="../../utils.html#utils.file_management.scroll_element_into_view">[docs]</a>
<span class="k">def</span> <span class="nf">scroll_element_into_view</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scrolls the web page to bring the element into the viewport.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        element (WebElement): The Selenium WebElement to scroll into view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView({block: &#39;center&#39;});&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_element_clickable">
<a class="viewcode-back" href="../../utils.html#utils.file_management.is_element_clickable">[docs]</a>
<span class="k">def</span> <span class="nf">is_element_clickable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the web page element is clickable.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        element (WebElement): The Selenium WebElement to check for clickability.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the element is clickable, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Adjust to wait for the specific element to be clickable</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">))))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">WebDriverException</span><span class="p">,</span> <span class="n">TimeoutException</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ensure_element_interactable">
<a class="viewcode-back" href="../../utils.html#utils.file_management.ensure_element_interactable">[docs]</a>
<span class="k">def</span> <span class="nf">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures the element is in view and interactable by scrolling into view and checking clickability.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        element (WebElement): The Selenium WebElement to make interactable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scrolling the element into view&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">scroll_element_into_view</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># A brief pause to ensure the page has settled</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if the element is clickable&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_element_clickable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

            
<span class="c1">### File Download ###    </span>

<div class="viewcode-block" id="perform_download_file">
<a class="viewcode-back" href="../../utils.html#utils.file_management.perform_download_file">[docs]</a>
<span class="k">def</span> <span class="nf">perform_download_file</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">DOWNLOADS_PATH</span><span class="p">,</span> <span class="n">max_wait_time</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">check_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads a file from NextCloud.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_name (str): The name of the file to download.</span>
<span class="sd">        DOWNLOADS_PATH (str): The path where the downloaded file will be saved.</span>
<span class="sd">        max_wait_time (int, optional): The maximum time (in seconds) to wait for the file to be downloaded. Defaults to 500.</span>
<span class="sd">        check_interval (int, optional): The interval (in seconds) between each check for the downloaded file. Defaults to 5.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the maximum wait time is exceeded while waiting for the file to download.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#### Modify the function to locate the file element and not not the action menu button ####</span>
    <span class="n">orange_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> from NextCloud...&quot;</span><span class="p">)</span>
    <span class="c1"># Load the xPath of the file, waits for the actions button to be clickable, then clicks it to reveal the download button</span>
    <span class="n">file_element_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span>
    <span class="n">actions_menu_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_element_xpath</span><span class="si">}</span><span class="s2">//a[@data-action=&#39;menu&#39;]&quot;</span>
    <span class="n">file_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">file_element_xpath</span><span class="p">)))</span>
    <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_element</span><span class="p">)</span>
    <span class="n">file_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element found &quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">actions_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;actions button found&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Click to open the action menu</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clicking the action menu&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">actions_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Action menu toggled, waiting for the download button to be clickable&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">download_button_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_element_xpath</span><span class="si">}</span><span class="s2">//a[@data-action=&#39;Download&#39;]&quot;</span>
    <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">download_button_xpath</span><span class="p">))</span>
    <span class="n">download_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">download_button_xpath</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download button found&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Click the download button</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clicking the download button&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">download_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download button clicked, waiting for file to be downloaded&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Dynamically wait for the file to be downloaded</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Check if the file exists</span>
        <span class="n">downloaded_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DOWNLOADS_PATH</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">downloaded_file_path</span><span class="p">):</span>
            <span class="k">break</span>

        <span class="c1"># Check if the maximum wait time has been exceeded</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">max_wait_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Maximum wait time exceeded while waiting for file to download&quot;</span><span class="p">)</span>

        <span class="c1"># Wait for a short period before checking again</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waiting for the file to download... Elapsed time: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">check_interval</span><span class="p">)</span>
        <span class="c1"># Close the action menu    </span>
    
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking if the file was downloaded to </span><span class="si">{</span><span class="n">downloaded_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">downloaded_file_path</span><span class="p">),</span> <span class="s2">&quot;The downloaded file was not found in the local directory&quot;</span></div>

       
<div class="viewcode-block" id="check_file_deletion">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_file_deletion">[docs]</a>
<span class="k">def</span> <span class="nf">check_file_deletion</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_element</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the uploaded file is absent in NextCloud.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_element (WebElement): The WebElement instance of the file.</span>
<span class="sd">        wait_time (int): The maximum time (in seconds) to wait for the file to be absent.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the file is absent within the specified wait time, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Waits for the file to disappear from the list</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">staleness_of</span><span class="p">(</span><span class="n">file_element</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File deleted, no longer in Nexcloud UI&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="calculate_sha256">
<a class="viewcode-back" href="../../utils.html#utils.file_management.calculate_sha256">[docs]</a>
<span class="k">def</span> <span class="nf">calculate_sha256</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the SHA-256 hash of a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path to the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The SHA-256 hash of the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Calculating SHA-256 hash of file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Initialize the hash object</span>
    <span class="n">sha256_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Read and update hash in chunks of 4K</span>
        <span class="k">for</span> <span class="n">byte_block</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">sha256_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">byte_block</span><span class="p">)</span>
    <span class="c1"># Return the hexadecimal digest        </span>
    <span class="k">return</span> <span class="n">sha256_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>



<div class="viewcode-block" id="toggle_file_upload">
<a class="viewcode-back" href="../../utils.html#utils.file_management.toggle_file_upload">[docs]</a>
<span class="k">def</span> <span class="nf">toggle_file_upload</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">FILE_UPLOAD_START_ID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles the file upload window by revealing the file upload input element.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: The WebDriver instance used to interact with the browser.</span>
<span class="sd">        FILE_UPLOAD_START_ID: The ID of the file upload input element.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: If the upload field is not visible.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Reveal the file upload input element</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;document.getElementById(&quot;</span><span class="si">{</span><span class="n">FILE_UPLOAD_START_ID</span><span class="si">}</span><span class="s1">&quot;).classList.remove(&quot;hiddenuploadfield&quot;);&#39;</span><span class="p">)</span>

        <span class="n">upload_field</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">FILE_UPLOAD_START_ID</span><span class="p">)</span>
        <span class="c1"># If the upload field is found, the navigation test passes. Else, it fails</span>
        <span class="k">assert</span> <span class="n">upload_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;The file upload window was not toggled.&quot;</span>
        <span class="k">if</span> <span class="n">upload_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File upload window toggled&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error, file upload window not toggled&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="click_new_fileOrFolder">
<a class="viewcode-back" href="../../utils.html#utils.file_management.click_new_fileOrFolder">[docs]</a>
<span class="k">def</span> <span class="nf">click_new_fileOrFolder</span> <span class="p">(</span><span class="n">driver</span><span class="p">,</span><span class="n">NEW_FILE_OR_FOLDER_MENU_XPATH</span> <span class="p">):</span>
            <span class="n">new_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">NEW_FILE_OR_FOLDER_MENU_XPATH</span><span class="p">)</span>
            <span class="n">new_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span></div>


<div class="viewcode-block" id="check_files_container_presence">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_files_container_presence">[docs]</a>
<span class="k">def</span> <span class="nf">check_files_container_presence</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the specific element is present on the page.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The Selenium WebDriver instance.</span>
<span class="sd">        timeout (int): Maximum time to wait for the element to be present.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the element is found within the timeout, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for the element to be present on the page.</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;app-content-files&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Element found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Element not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    

            
<div class="viewcode-block" id="ensure_logged_in_and_goto_files">
<a class="viewcode-back" href="../../utils.html#utils.file_management.ensure_logged_in_and_goto_files">[docs]</a>
<span class="k">def</span> <span class="nf">ensure_logged_in_and_goto_files</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">TARGET_URL</span><span class="p">,</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">,</span> <span class="n">FILES_TAB_XPATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function checks if the the file container is present first, if it is then it passes to proceed to other tasks, else it logs in and navigates to the files page.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        TARGET_URL (str): The URL of the NextCloud instance.</span>
<span class="sd">        USERNAME (str): The username to use for logging in.</span>
<span class="sd">        PASSWORD (str): The password to use for logging in.</span>
<span class="sd">        LOGIN_BUTTON_XPATH (str): The XPath expression for the login button.</span>
<span class="sd">        FILES_TAB_XPATH (str): The XPath of the &quot;Files&quot; button.</span>
<span class="sd">        NEW_FILE_OR_FOLDER_MENU_XPATH (str): The XPath of the &quot;New file/folder menu&quot; button.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># If not logged in, perform login</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_if_loggedIn</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not logged in, logging in&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">login_to_nextcloud</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">TARGET_URL</span><span class="p">,</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If logged in and file container present, pass</span>
            <span class="k">if</span> <span class="n">check_files_container_presence</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User logged in and file container present, passing&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># If not logged in or file container not present, navigate to the files page</span>
        <span class="n">goto_files</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">FILES_TAB_XPATH</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span></div>



<div class="viewcode-block" id="goto_files">
<a class="viewcode-back" href="../../utils.html#utils.file_management.goto_files">[docs]</a>
<span class="k">def</span> <span class="nf">goto_files</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">FILES_TAB_XPATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Navigates to the files page and opens the file upload dialog.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The Selenium WebDriver instance.</span>
<span class="sd">        FILES_TAB_XPATH (str): The XPath of the &quot;Files&quot; button.</span>
<span class="sd">        NEW_FILE_OR_FOLDER_MENU_XPATH (str): The XPath of the &quot;New file/folder menu&quot; button.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs during navigation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Navigating to the files page&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">files_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">FILES_TAB_XPATH</span><span class="p">)</span>
        <span class="n">files_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files page button clicked&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Navigation to files failed due to an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

 
 
<span class="c1">### Integrity Check ###        </span>
        
<div class="viewcode-block" id="compare_hashes">
<a class="viewcode-back" href="../../utils.html#utils.file_management.compare_hashes">[docs]</a>
<span class="k">def</span> <span class="nf">compare_hashes</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">DOWNLOAD_DIRECTORY</span><span class="p">,</span><span class="n">CREATED_FILES_PATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function compares the SHA-256 hashes of the uploaded and downloaded files.</span>

<span class="sd">    It calculates the SHA-256 hash of both the uploaded and downloaded files and compares them. </span>
<span class="sd">    If the hashes are not the same, it raises an AssertionError.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): The name of the file.</span>
<span class="sd">        DOWNLOAD_DIRECTORY (str): The directory where the downloaded file is stored.</span>
<span class="sd">        CREATED_FILES_PATH (str): The directory where the uploaded file is stored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the hashes are the same, False otherwise.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs while comparing the hashes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dowloaded_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DOWNLOAD_DIRECTORY</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">uploaded_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CREATED_FILES_PATH</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">uploaded_file_hash</span> <span class="o">=</span> <span class="n">calculate_sha256</span><span class="p">(</span><span class="n">uploaded_file_path</span><span class="p">)</span>
        <span class="n">downloaded_file_hash</span> <span class="o">=</span> <span class="n">calculate_sha256</span><span class="p">(</span><span class="n">dowloaded_file_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">uploaded_file_hash</span> <span class="o">==</span> <span class="n">downloaded_file_hash</span><span class="p">,</span> <span class="s2">&quot;The uploaded and downloaded files have different hashes&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while comparing the hashes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

 
     
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">### Deletion ###</span>

<div class="viewcode-block" id="scroll_with_mouse_wheel">
<a class="viewcode-back" href="../../utils.html#utils.file_management.scroll_with_mouse_wheel">[docs]</a>
<span class="k">def</span> <span class="nf">scroll_with_mouse_wheel</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">deltaY</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scroll within an element using the mouse wheel.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        element (WebElement): The element to scroll within.</span>
<span class="sd">        deltaY (int): The vertical scroll amount (positive scrolls down, negative scrolls up).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scroll_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        var event = new WheelEvent(&#39;wheel&#39;, {</span>
<span class="s2">            &#39;deltaY&#39;: arguments[1],</span>
<span class="s2">            &#39;deltaMode&#39;: 0</span>
<span class="s2">        });</span>
<span class="s2">        arguments[0].dispatchEvent(event);</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">scroll_script</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">deltaY</span><span class="p">)</span></div>



<div class="viewcode-block" id="scroll_to_bottom_dynamic">
<a class="viewcode-back" href="../../utils.html#utils.file_management.scroll_to_bottom_dynamic">[docs]</a>
<span class="k">def</span> <span class="nf">scroll_to_bottom_dynamic</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">scrollable_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;app-content&quot;]&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].focus();&quot;</span><span class="p">,</span> <span class="n">scrollable_element</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element </span><span class="si">{</span><span class="n">scrollable_element</span><span class="si">}</span><span class="s2"> found and ready for scrolling.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files list element found and ready for scrolling.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="n">old_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scrolling to the bottom of the page&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scroll_with_mouse_wheel</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">scrollable_element</span><span class="p">,</span> <span class="n">deltaY</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the files to load&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
            <span class="n">new_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;tbody.files-fileList &gt; tr&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">new_count</span> <span class="o">==</span> <span class="n">old_count</span><span class="p">:</span>
                <span class="c1"># No new files loaded, assume end of list</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">old_count</span> <span class="o">=</span> <span class="n">new_count</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollTop = arguments[0].scrollHeight;&quot;</span><span class="p">,</span> <span class="n">scrollable_element</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait for files to load</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while scrolling: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_delete_button">
<a class="viewcode-back" href="../../utils.html#utils.file_management.find_delete_button">[docs]</a>
<span class="k">def</span> <span class="nf">find_delete_button</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the delete button of the file in NexcCloud UI.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_name (str): The name of the file to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Web element: A tuple containing the WebElement instance of the delete button.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the actions button to be clickable&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Load the xPath of the file, waits for the actions button to be clickable, then clicks it to reveal the download button</span>
    <span class="n">file_element_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span>
    <span class="n">actions_menu_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_element_xpath</span><span class="si">}</span><span class="s2">//a[@data-action=&#39;menu&#39;]&quot;</span>
    <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">))</span>
    <span class="c1"># Find the file_element</span>
    <span class="n">file_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">file_element_xpath</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">)))</span>
    <span class="n">actions_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">actions_menu_xpath</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">actions_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Action menu clicked, waiting for the delete button to be clickable&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Find the delete button for the file</span>
    <span class="n">delete_button_xpath</span> <span class="o">=</span> <span class="s2">&quot;//div[contains(@class, &#39;fileActionsMenu&#39;)]//a[contains(@class, &#39;action-delete&#39;) and @data-action=&#39;Delete&#39;]&quot;</span>
    <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">delete_button_xpath</span><span class="p">))</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">delete_button_xpath</span><span class="p">)))</span>
    <span class="n">delete_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">delete_button_xpath</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">delete_button</span><span class="p">,</span> <span class="n">file_element</span>   </div>

        
<div class="viewcode-block" id="perform_delete_file">
<a class="viewcode-back" href="../../utils.html#utils.file_management.perform_delete_file">[docs]</a>
<span class="k">def</span> <span class="nf">perform_delete_file</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scrolling to the bottom of the page to load the whole content &quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scroll_to_bottom_dynamic</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">delete_button</span><span class="p">,</span> <span class="n">file_element</span> <span class="o">=</span> <span class="n">find_delete_button</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">delete_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Delete button clicked&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Wait for the file to disappear from the file list, if not, the test fails</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if the file was deleted&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_deleted</span> <span class="o">=</span> <span class="n">check_file_deletion</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_element</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">green_text</span><span class="p">(</span><span class="s2">&quot;Success, file deleted&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">file_deleted</span><span class="p">,</span> <span class="s2">&quot;large size file was not deleted&quot;</span>
        
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while deleting the file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>



<span class="c1">### Locate file in the UI ###</span>
<div class="viewcode-block" id="locate_file_in_nextcloud">
<a class="viewcode-back" href="../../utils.html#utils.file_management.locate_file_in_nextcloud">[docs]</a>
<span class="k">def</span> <span class="nf">locate_file_in_nextcloud</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Locates a file in NextCloud.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_name (str): The name of the file to locate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the file is found, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for the file to appear in the list</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">file_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;//tr[@data-file=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">)</span>
        <span class="n">scroll_element_into_view</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_element</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File not found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<span class="c1">### File Sharing ### </span>





    
<div class="viewcode-block" id="share_file_with_recipient">
<a class="viewcode-back" href="../../utils.html#utils.file_management.share_file_with_recipient">[docs]</a>
<span class="k">def</span> <span class="nf">share_file_with_recipient</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">SHARE_WITH_ANOTHER_USER_INPUT_XPATH</span><span class="p">,</span> <span class="n">SAVE_SHARING_BUTTON_XPATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Share a file with a recipient.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: The WebDriver instance.</span>
<span class="sd">        username: The username of the recipient.</span>
<span class="sd">        file_name: The name of the file to be shared.</span>
<span class="sd">        SHARE_WITH_ANOTHER_USER_INPUT_XPATH: The XPath of the input field for sharing with another user.</span>
<span class="sd">        SAVE_SHARING_BUTTON_XPATH: The XPath of the button to save the sharing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs while locating and filling the search field.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for the search field to be interactable</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the search field to be interactable&quot;</span><span class="p">)</span>
        <span class="n">search_field</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">SHARE_WITH_ANOTHER_USER_INPUT_XPATH</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search field is interactable&quot;</span><span class="p">)</span>
        <span class="c1"># Scroll the search field into view</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scrolling the search field into view&quot;</span><span class="p">)</span>
        <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">search_field</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filling the search field with the recipient&#39;s username: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">search_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">search_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enter button clicked&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the save sharing button to be clickable&quot;</span><span class="p">)</span>
        <span class="n">save_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">SAVE_SHARING_BUTTON_XPATH</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clicking the save sharing button&quot;</span><span class="p">)</span>
        <span class="n">save_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Save sharing button is clicked&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> shared with </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while locating and filling the search field: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

    

       

        



<div class="viewcode-block" id="ifLogin_delete_cookies">
<a class="viewcode-back" href="../../utils.html#utils.file_management.ifLogin_delete_cookies">[docs]</a>
<span class="k">def</span> <span class="nf">ifLogin_delete_cookies</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">TARGET_URL</span><span class="o">=</span><span class="n">TARGET_URL</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the page contains the file name and the download button.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used to interact with the browser.</span>
<span class="sd">        internal_share_link (str): The internal file sharing link to navigate to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the page contains the file name and the download button, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if logged in&quot;</span><span class="p">)</span>
        <span class="n">check_login</span> <span class="o">=</span> <span class="n">get_token_from_cookies</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_login</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User is logged in, deleting cookies and refreshing the page&quot;</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">delete_all_cookies</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cookies deleted&quot;</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TARGET_URL</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Page refreshed&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if logged out&quot;</span><span class="p">)</span>
            <span class="n">check_logout</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while checking login status and deletin cookies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> </div>

           


<div class="viewcode-block" id="check_url_login_page">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_url_login_page">[docs]</a>
<span class="k">def</span> <span class="nf">check_url_login_page</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the current URL is the login page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;login&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while checking the URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>    </div>

    
<div class="viewcode-block" id="get_internal_share_link">
<a class="viewcode-back" href="../../utils.html#utils.file_management.get_internal_share_link">[docs]</a>
<span class="k">def</span> <span class="nf">get_internal_share_link</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">INTERNAL_LINK_COPY_BUTTON_XPATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the internal share link of a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: The WebDriver instance used to interact with the browser.</span>
<span class="sd">        INTERNAL_LINK_COPY_BUTTON_XPATH: The XPath of the internal link copy button.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The internal share link of the file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs while getting the internal share link.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
     
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the internal share link button to be clickable&quot;</span><span class="p">)</span>
        <span class="n">internal_share_link_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">INTERNAL_LINK_COPY_BUTTON_XPATH</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Internal share button is clickable&quot;</span><span class="p">)</span>
        <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">internal_share_link_button</span><span class="p">)</span>
        <span class="c1"># Disable scrolling</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.overflow = &#39;hidden&#39;;&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.documentElement.style.overflow = &#39;hidden&#39;;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Internal share link button is scrolled into view&quot;</span><span class="p">)</span>
        <span class="n">internal_share_link_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1">### Get href from the button</span>
        <span class="n">internal_share_link</span> <span class="o">=</span> <span class="n">internal_share_link_button</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="c1">#internal_share_link = wait_for_clipboard_change(old_clipboard_content, timeout=10, check_interval=0.5)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Internal share link button is clicked&quot;</span><span class="p">)</span>  
        <span class="c1"># Enable scrolling</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.overflow = &#39;&#39;;&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.documentElement.style.overflow = &#39;&#39;;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">internal_share_link</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while getting the internal share link: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

    
<div class="viewcode-block" id="get_external_share_link">
<a class="viewcode-back" href="../../utils.html#utils.file_management.get_external_share_link">[docs]</a>
<span class="k">def</span> <span class="nf">get_external_share_link</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">EXTERNAL_LINK_COPY_BUTTON_XPATH</span><span class="p">,</span> <span class="n">EXTERNAL_LINK_COPY_BUTTON_XPATH_HREF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the external share link of a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: The WebDriver instance used to interact with the browser.</span>
<span class="sd">        EXTERNAL_LINK_COPY_BUTTON_XPATH: The XPath of the external link copy button.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The external share link of the file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs while getting the external share link.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the external share link button to be clickable&quot;</span><span class="p">)</span>
        <span class="n">external_share_link_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">EXTERNAL_LINK_COPY_BUTTON_XPATH</span><span class="p">)))</span>
        <span class="n">ensure_element_interactable</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">external_share_link_button</span><span class="p">)</span>
        <span class="c1"># Disable scrolling</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Disabling scrolling&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.overflow = &#39;hidden&#39;;&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.documentElement.style.overflow = &#39;hidden&#39;;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;External share link button is clickable&quot;</span><span class="p">)</span>
        <span class="n">external_share_link_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1">### Get href from the button</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">EXTERNAL_LINK_COPY_BUTTON_XPATH_HREF</span><span class="p">)))</span>
        <span class="n">external_share_link</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;External share link button is clicked&quot;</span><span class="p">)</span>
        <span class="c1"># Enable scrolling</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enabling scrolling&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.overflow = &#39;&#39;;&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.documentElement.style.overflow = &#39;&#39;;&quot;</span><span class="p">)</span>       
        <span class="k">return</span> <span class="n">external_share_link</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while getting the external share link: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

    

<div class="viewcode-block" id="logout_and_goto_external_link">
<a class="viewcode-back" href="../../utils.html#utils.file_management.logout_and_goto_external_link">[docs]</a>
<span class="k">def</span> <span class="nf">logout_and_goto_external_link</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">LOGOUT_BUTTON_PATH</span><span class="p">,</span><span class="n">LOGIN_BUTTON_XPATH</span><span class="p">,</span><span class="n">OPEN_SETTINGS_MENU_XPATH</span><span class="p">,</span><span class="n">CLOSED_SETTINGS_MENU_XPATH</span><span class="p">,</span> <span class="n">EXTERNAL_LINK</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">perform_logout</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">LOGOUT_BUTTON_PATH</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">,</span> <span class="n">OPEN_SETTINGS_MENU_XPATH</span><span class="p">,</span> <span class="n">CLOSED_SETTINGS_MENU_XPATH</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EXTERNAL_LINK</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while logging out: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

    
<div class="viewcode-block" id="check_external_file_sharing">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_external_file_sharing">[docs]</a>
<span class="k">def</span> <span class="nf">check_external_file_sharing</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the page contains the file name and the download button.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for the external file sharing&quot;</span><span class="p">)</span>
        <span class="n">check_element_x_path</span> <span class="o">=</span> <span class="n">generate_external_share_verification_element</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking for the external file sharing: </span><span class="si">{</span><span class="n">check_element_x_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">check_element_x_path</span><span class="p">)))</span>
        <span class="n">green_text</span><span class="p">(</span><span class="s2">&quot;File found, external file sharing succeeded&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while checking for the external file sharing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>


<div class="viewcode-block" id="generate_external_share_verification_element">
<a class="viewcode-back" href="../../utils.html#utils.file_management.generate_external_share_verification_element">[docs]</a>
<span class="k">def</span> <span class="nf">generate_external_share_verification_element</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the XPath for the verification element for external file sharing.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_name (str): The name of the file to generate the XPath for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The generated XPath for the verification element.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;//span[contains(text(), &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;)]&quot;</span></div>


<div class="viewcode-block" id="check_internal_file_share">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_internal_file_share">[docs]</a>
<span class="k">def</span> <span class="nf">check_internal_file_share</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">internal_share_link</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking for the internal file sharing...&#39;</span><span class="p">)</span>
      <span class="c1"># Ensure that the user is logged out when accessing the internal share link</span>
      <span class="n">ifLogin_delete_cookies</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
      <span class="c1"># Navigate to the internal share link</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">internal_share_link</span><span class="p">)</span>  
      <span class="c1"># Check that the file is not accessible to the public</span>
      <span class="k">if</span> <span class="n">check_url_login_page</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
          <span class="n">green_text</span><span class="p">(</span><span class="s2">&quot;Success, internal share link not accessible to the public&quot;</span><span class="p">)</span>
          
      <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Internal share link accessible to the public&quot;</span><span class="p">)</span>
      <span class="c1"># Login to nextcloud using the internal share link and check if the file is accessible</span>
      <span class="n">login_to_nextcloud</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">internal_share_link</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">LOGIN_BUTTON_XPATH</span><span class="p">)</span>
      <span class="n">check_internal_sharing</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
      <span class="c1"># Login as another user and check if the file is accessible</span>
      
      
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while checking for the internal file sharing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

       
<div class="viewcode-block" id="generate_internal_sharing_verification_element_exists">
<a class="viewcode-back" href="../../utils.html#utils.file_management.generate_internal_sharing_verification_element_exists">[docs]</a>
<span class="k">def</span> <span class="nf">generate_internal_sharing_verification_element_exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the XPath for the verification element for internal file sharing.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): The WebDriver instance used for browser automation.</span>
<span class="sd">        file_name (str): The name of the file to generate the XPath for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The generated XPath for the verification element.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;//div[contains(@class, &#39;modal-header&#39;)]//h2[contains(text(), &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;)]&quot;</span>
    <span class="k">return</span> <span class="n">xpath</span></div>

    
<div class="viewcode-block" id="check_internal_sharing">
<a class="viewcode-back" href="../../utils.html#utils.file_management.check_internal_sharing">[docs]</a>
<span class="k">def</span> <span class="nf">check_internal_sharing</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for the internal file sharing...&quot;</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">generate_internal_sharing_verification_element_exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">))))</span>
        <span class="n">green_text</span><span class="p">(</span><span class="s2">&quot;File found, internal file sharing succeeded&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while checking for the internal file sharing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Skander Lahbaiel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>